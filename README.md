# GMod TCP

Система обмена сообщениями между сервером и клиентами через TCP/HTTP протоколы.

## Компоненты

- **server** - TCP сервер для клиентов + HTTP API сервер для веб-приложения
- **client** - Модуль для Garry's Mod (можно адаптировать под другие платформы)
- **client_app** - Десктопное приложение для управления донатами
- **shared** - Общие типы данных и протоколы

## Настройка сервера

Создайте файл `server/.env`:

```env
# TCP сервер (для клиентов)
HOST=0.0.0.0
PORT=25565

# HTTP API сервер
API_HOST=0.0.0.0
API_PORT=8080

# CORS
ALLOWED_ORIGINS=*

# API пароль (обязательно для защиты), можете через запятую указывать ряд паролей.
# Приложением пользователься полноценно без паролей не выйдет.
API_PASSWORDS=your_password_here

# Не забудьте указать в client_app/.env (создайте этот файл) API_URL
# Пример: API_URL = http://localhost:8080
# Если сертификаты не указаны, сервер автоматически создаст самоподписанные
# В client_app/.env укажите API_URL=https://your-domain.com:443 для HTTPS
```

### Запуск

```bash
cd server
cargo run --release
```

## Клиент для Garry's Mod

Клиент (`client/`) реализован как модуль для Garry's Mod, но может быть адаптирован под любые другие цели.
Основные функции позволяют это сделать при желании, единственная проблема адаптивности в данный момент - поиск uuid и tcp в .txt файлах, которые лежат в директориях гмода.
Основная логика работы:

- Регистрация клиента на сервере
- Периодический опрос сервера на новые сообщения
- Передача сообщений в Lua через глобальные функции

### Lua API

- `GModTCPGetMessages()` - получить сообщения из очереди (возвращает таблицу или nil)
- `GModTCPPollNow()` - принудительно запросить сообщения с сервера

## HTTPS
Работает с помощью nginx.

## Сборка

```bash
# Весь проект
cargo build --release

# Только сервер
cd server && cargo build --release

# Только клиент
cd client && cargo build --release

# Только приложение
cd client_app && cargo build --release
```

